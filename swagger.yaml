swagger: '2.0'
info:
  version: '1.0'
  title: "Webhook Relay"
  description: >-
    Fast, secure tunnels to your internal networks. Webhook Relay allows you to expose your localhost 
    or any other server in private network to the public internet without configuring port forwarding 
    or firewalls. API accepts username/password, token key/secret pairs and JWT authentication methods.
  # license:
  #   name: Propriatary
  #   url: https://github.com/apiaryio/polls-api/blob/master/LICENSE
host: webhookrelay.apiblueprint.org
basePath: /
schemes:
- "https"
consumes:
- application/json
produces:
- application/json
paths:
  /v1/tunnels:
    x-summary: List and create tunnels
    get:
      tags:
        - "tunnel"
      summary: List All Tunnels
      responses:
        200:
          description: Successful Response
          schema:
            type: array
            items:
              $ref: '#/definitions/Tunnel'
          examples:
            application/json:
              - id: 'b3237483-e96e-4f3a-905c-0d9603d66c1f'
                created_at: 1534409264
                updated_at: 1534409264
                name: 'tunnel-x'
                destination: 'http://localhost:4000'
                host: 'tunnelx.webrelay.io'
    post:
      tags:
        - "tunnel"
      description: >-
        You may create your own tunnel using this action. It takes a JSON
        object containing a tunnel request with a specified destination. Paid plans
        have an option to specify either encryption, subdomain or full domain.
      summary: Create a New Tunnel
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/TunnelCreateRequest'
      responses:
        201:
          description: ''
          schema:
            $ref: '#/definitions/Tunnel'
          examples:
            application/json:
                id: b3237483-e96e-4f3a-905c-0d9603d66c1f
                created_at: 1534409264
                updated_at: 1534409264
                name: 'tunnel-x'
                destination: 'http://localhost:4000'
                host: 'tunnelx.webrelay.io'
        400:
          description: "Invalid tunnel request supplied"
  /v1/tunnels/{tunnelID}/:
    x-summary: Get, update and delete tunnels
    parameters:
      - name: "tunnelID"
        in: "path"
        description: "ID of tunnel to return"
        required: true
        type: "string"
    get:
      tags:
        - "tunnel"
      summary: Get Tunnel Details
      responses:
        200:
          description: Successful Response
          schema:
             $ref: "#/definitions/Tunnel"
          examples:
            application/json:
              created_at: 1534409264
              updated_at: 1534409264
              id: b3237483-e96e-4f3a-905c-0d9603d66c1f
              destination: http://localhost:8090
              name: tunnel
              group: ''
              addr: ''
              host: tunnelx.webrelay.io
              mode: active
              protocol: http
              account_id: bd7e1dfc-54c8-408c-a885-7498bf1d8522
              description: ''
              features: 
              auth:
                created_at: 1534409264
                updated_at: 1534409264
                id: eb3fbc49-0713-48b1-8971-a7c4a9c64dfb
                type: none
              agent_id: ''
              ingress_rules: 
              crypto: 'off'
        404:
          description: Tunnel not found
    put:
      tags:
        - "tunnel"
      summary: Update Tunnel Details
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/TunnelCreateRequest'
      responses:
        200:
          description: Successful Response
          schema:
             $ref: "#/definitions/Tunnel"
          examples:
            application/json:
              created_at: 1534409264
              updated_at: 1534409264
              id: b3237483-e96e-4f3a-905c-0d9603d66c1f
              destination: http://localhost:8090
              name: tunnel
              group: ''
              addr: ''
              host: tunnelx.webrelay.io
              mode: active
              protocol: http
              account_id: bd7e1dfc-54c8-408c-a885-7498bf1d8522
              description: ''
              features: 
              auth:
                created_at: 1534409264
                updated_at: 1534409264
                id: eb3fbc49-0713-48b1-8971-a7c4a9c64dfb
                type: none
              agent_id: ''
              ingress_rules: 
              crypto: 'off'
        404:
          description: Tunnel not found
        400:
          description: Bad request (check response message)
    delete:
      tags:
        - "tunnel"
      summary: Delete Tunnel
      responses:
        200:
          description: Successful Response          
        404:
          description: Tunnel not found        
  # Token configuration
  /v1/tokens:
    x-summary: List and create tunnels
    get:
      tags:
        - "token"
      summary: List All Authentication Tokens
      responses:
        200:
          description: Successful Response
          schema:
            type: array
            items:
              $ref: '#/definitions/Token'
          
    post:
      tags:
        - "token"
      summary: Create a New Authentication Token
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/TokenRequest'
      responses:
        201:
          description: 'Create a new token'
          schema:
            $ref: '#/definitions/TokenCreateResponse'
          examples:
            application/json:                
              created_at: 1535365683
              updated_at: 1536161359              
              id: cc58c9ea-5fa7-466e-91dc-5c08d0b1127c
              description: ''
              scopes:
                buckets: []
                tunnels:
                - foo
                - bar
                - faa                
              active: true
              api_disabled: true
        400:
          description: ''
  /v1/tokens/{tokenID}/: 
    x-summary: Update and delete tokens
    parameters:
      - name: "tokenID"
        in: "path"
        description: "ID of token"
        required: true
        type: "string"
    put:
      tags:
        - "token"
      summary: Update Token Details
      parameters:
        - name: body
          in: body
          required: true
          schema:
            $ref: '#/definitions/TokenRequest'
      responses:
        200:
          description: Successful Response
          schema:
             $ref: "#/definitions/Token"
          examples:
            application/json:
              application/json:                
              created_at: 1535365683
              updated_at: 1536161359              
              id: cc58c9ea-5fa7-466e-91dc-5c08d0b1127c
              description: ''
              scopes:
                buckets: []
                tunnels:
                - foo
                - bar
                - faa                
              active: true
              api_disabled: true
        404:
          description: Tunnel not found
        400:
          description: Bad request (check response message)
    delete:
      tags:
        - "token"
      summary: Delete Token
      responses:
        200:
          description: Successful Response          
        404:
          description: Token not found
definitions:
  # --------------------------- tunnels ---------------------------
  Tunnel:
    title: Tunnel
    type: object
    properties:
      id:
        type: string
      created_at:
        type: integer
      updated_at:
        type: integer
      destination:
        type: string
      name:
        type: string
      group:
        type: string
      host:
        type: string
      protocol:
        type: string
      description:
        type: string
      auth:
        type: object
        $ref: '#/definitions/TunnelAuth'
      crypto:
        type: string      
    example:
      created_at: 1534409264
      updated_at: 1534409264
      id: b3237483-e96e-4f3a-905c-0d9603d66c1f
      destination: http://localhost:8090
      name: tunnel
      group: ''
      addr: ''
      host: tunnelx.webrelay.io
      mode: active
      protocol: http
      account_id: bd7e1dfc-54c8-408c-a885-7498bf1d8522
      description: ''
      features: 
      auth:
        created_at: 1534409264
        updated_at: 1534409264
        id: eb3fbc49-0713-48b1-8971-a7c4a9c64dfb
        type: none
      agent_id: ''
      ingress_rules: 
      crypto: 'off'

  TunnelAuth:
    title: Tunnel Authentication
    type: object
    properties:
      id:
        type: string
      created_at:
        type: integer
      updated_at:
        type: integer
      type:
        type: string
      username:
        type: string
      password:
        type: string
      token:
        type: string  
  TunnelCreateRequest:
    title: Tunnel Create Request
    type: object
    properties:
      name:
        type: string
      group:
        type: string
      destination:
        type: string
      subdomain:
        type: string
      host:
        type: string
      crypto:
        type: string
      auth:
        type: object
        $ref: '#/definitions/TunnelAuth'
      description:
        type: string
    required:
      - destination
    example:
      name: tunnel-x
      subdomain: tunnelx
      destination: http://localhost:4000
  TunnelUpdateRequest:
    title: Tunnel Update Request
    type: object
    properties:
      name:
        type: string
      destination:
        type: string      
      crypto:
        type: string
      auth:
        type: object
        $ref: '#/definitions/TunnelAuth'
      description:
        type: string
    example:
      name: tunnel-x
      subdomain: tunnelx
      destination: http://localhost:4000
  # --------------------------- tokens ---------------------------
  Token:
    title: Token
    type: object
    properties:
      id:
        type: string      
      created_at:
        type: integer
      updated_at:
        type: integer
      last_login:
        type: string  
      description:
        type: string
      scopes:
        type: object
        $ref: '#/definitions/TokenScopes'
      api_access:
        type: string

  TokenRequest:
    title: Token Request
    type: object
    properties:
      description:
        type: string
      scopes:
        type: object
        $ref: '#/definitions/TokenScopes'
      api_access:
        type: string
        description: "Can be either 'enabled' or 'disabled'. Tokens with disabled API access can only be used to open tunnels or forward webhooks"
  TokenCreateResponse:
     title: Token Create Response
     type: object
     properties:
      id:
        type: string
        description: "Token ID is used as a key"
      secret:
        type: string
        description: "This is the only time secret is revealed as it is already encrypted by the system"
      created_at:
        type: integer
      updated_at:
        type: integer
      last_login:
        type: string  
      description:
        type: string
      scopes:
        type: object
        $ref: '#/definitions/TokenScopes'
      api_access:
        type: string  
  TokenScopes:
    title: TokenScopes
    type: object
    properties:
      tunnels:
        type: array
        items:
          type: string
      buckets:
        type: array
        items:
          type: string
  # QuestionRequest:
  #   title: Question Request
  #   type: object
  #   properties:
  #     question:
  #       type: string
  #     choices:
  #       type: array
  #       items:
  #         type: string
  #   required:
  #     - question
  #     - choices
  #   example:
  #     question: Favourite programming language?
  #     choices:
  #       - Swift
  #       - Python
  #       - Objective-C
  #       - Ruby
